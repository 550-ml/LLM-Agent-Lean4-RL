# LLM-Agent-Lean4-RL å¼€å‘æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ—¨åœ¨æ„å»ºä¸€ä¸ªåŸºäºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æ™ºèƒ½ä½“ç³»ç»Ÿï¼Œç”¨äºè‡ªåŠ¨ç”Ÿæˆå’ŒéªŒè¯ Lean4 å½¢å¼åŒ–è¯æ˜ã€‚ç³»ç»Ÿé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒæœ¬åœ°å’Œè¿œç¨‹ LLM è°ƒç”¨ï¼Œå¹¶é¢„ç•™å¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰æ¨¡å—ç”¨äºæœªæ¥ä¼˜åŒ–ã€‚

### æ ¸å¿ƒç›®æ ‡
1. **è‡ªåŠ¨åŒ–å½¢å¼åŒ–è¯æ˜ç”Ÿæˆ**ï¼šå°†è‡ªç„¶è¯­è¨€é—®é¢˜è½¬æ¢ä¸º Lean4 å½¢å¼åŒ–è¯æ˜
2. **å¤šæ¨¡å‹æ”¯æŒ**ï¼šæ”¯æŒæœ¬åœ°æ¨¡å‹ï¼ˆå¦‚ vLLMï¼‰å’Œè¿œç¨‹ APIï¼ˆå¦‚ OpenAIï¼‰
3. **æ™ºèƒ½ä½“åä½œ**ï¼šå¤šæ™ºèƒ½ä½“æ¶æ„ï¼Œåˆ†å·¥åä½œå®Œæˆè¯æ˜ä»»åŠ¡
4. **å¯æ‰©å±•æ€§**ï¼šé¢„ç•™ RL æ¨¡å—æ¥å£ï¼Œæ”¯æŒæœªæ¥é€šè¿‡å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–è¯æ˜ç­–ç•¥

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      LLM-Agent-Lean4-RL                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚  LLM  â”‚          â”‚   Agent   â”‚         â”‚ Lean4   â”‚
    â”‚ Moduleâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Module   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Verifier â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                    â”‚                     â”‚
        â”‚              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                â”‚
        â”‚              â”‚    RL    â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Module  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Data & Config   â”‚
                    â”‚  - Benchmarks     â”‚
                    â”‚  - Prompts        â”‚
                    â”‚  - Logs           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ¨¡å—è®¾è®¡

### 1. LLM æ¨¡å— (`src/llm/`)

#### 1.1 è®¾è®¡ç›®æ ‡
- ç»Ÿä¸€æ¥å£ï¼šä¸ºæœ¬åœ°å’Œè¿œç¨‹ LLM æä¾›ç»Ÿä¸€çš„è°ƒç”¨æ¥å£
- çµæ´»åˆ‡æ¢ï¼šæ”¯æŒè¿è¡Œæ—¶åˆ‡æ¢ä¸åŒçš„ LLM åç«¯
- æ€§èƒ½ä¼˜åŒ–ï¼šæ”¯æŒæ‰¹é‡è¯·æ±‚ã€æµå¼å“åº”ã€ç¼“å­˜ç­‰

#### 1.2 ç›®å½•ç»“æ„
```
src/llm/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ base.py              # åŸºç¡€ LLM æ¥å£æŠ½è±¡ç±»
â”œâ”€â”€ openai_client.py     # OpenAI API å®¢æˆ·ç«¯
â”œâ”€â”€ vllm_client.py       # vLLM æœ¬åœ°æ¨¡å‹å®¢æˆ·ç«¯
â”œâ”€â”€ ollama_client.py     # Ollama æœ¬åœ°æ¨¡å‹å®¢æˆ·ç«¯ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ factory.py           # LLM å·¥å‚ç±»ï¼Œç»Ÿä¸€åˆ›å»ºæ¥å£
â””â”€â”€ utils.py             # å·¥å…·å‡½æ•°ï¼ˆtoken è®¡æ•°ã€æ ¼å¼åŒ–ç­‰ï¼‰
```

#### 1.3 æ ¸å¿ƒæ¥å£è®¾è®¡

```python
# src/llm/base.py
from abc import ABC, abstractmethod
from typing import List, Dict, Optional, Iterator
from dataclasses import dataclass

@dataclass
class LLMConfig:
    """LLM é…ç½®ç±»"""
    model_name: str
    temperature: float = 0.7
    max_tokens: int = 2048
    top_p: float = 1.0
    api_key: Optional[str] = None
    base_url: Optional[str] = None
    timeout: int = 60

@dataclass
class LLMResponse:
    """LLM å“åº”å°è£…"""
    content: str
    model: str
    usage: Dict[str, int]  # tokens used
    finish_reason: str

class BaseLLM(ABC):
    """LLM åŸºç¡€æŠ½è±¡ç±»"""
    
    def __init__(self, config: LLMConfig):
        self.config = config
    
    @abstractmethod
    def generate(self, messages: List[Dict[str, str]], **kwargs) -> LLMResponse:
        """ç”Ÿæˆå“åº”"""
        pass
    
    @abstractmethod
    def stream_generate(self, messages: List[Dict[str, str]], **kwargs) -> Iterator[str]:
        """æµå¼ç”Ÿæˆå“åº”"""
        pass
    
    @abstractmethod
    def count_tokens(self, text: str) -> int:
        """è®¡ç®— token æ•°é‡"""
        pass
```

#### 1.4 å®ç°è¦ç‚¹

**OpenAI å®¢æˆ·ç«¯** (`openai_client.py`):
- ä½¿ç”¨ `openai` åº“
- æ”¯æŒ GPT-4o, GPT-4, o3-mini ç­‰æ¨¡å‹
- ç¯å¢ƒå˜é‡ï¼š`OPENAI_API_KEY`

**vLLM å®¢æˆ·ç«¯** (`vllm_client.py`):
- ä½¿ç”¨ `vllm` åº“è¿è¡Œæœ¬åœ°æ¨¡å‹
- æ”¯æŒ HuggingFace æ¨¡å‹
- è‡ªåŠ¨ç®¡ç† vLLM æœåŠ¡å™¨ç”Ÿå‘½å‘¨æœŸ
- æ”¯æŒå¤š GPU å¹¶è¡Œ

**å·¥å‚æ¨¡å¼** (`factory.py`):
```python
class LLMFactory:
    @staticmethod
    def create_llm(config: LLMConfig) -> BaseLLM:
        """æ ¹æ®é…ç½®åˆ›å»ºå¯¹åº”çš„ LLM å®ä¾‹"""
        if config.model_name.startswith("gpt-") or config.model_name.startswith("o"):
            return OpenAIClient(config)
        elif config.model_name.startswith("vllm:"):
            return VLLMClient(config)
        elif config.model_name.startswith("ollama:"):
            return OllamaClient(config)
        else:
            raise ValueError(f"Unsupported model: {config.model_name}")
```

---

### 2. Agent æ¨¡å— (`src/agent/`)

#### 2.1 è®¾è®¡ç›®æ ‡
- å¤šæ™ºèƒ½ä½“åä½œï¼šè§„åˆ’ã€ç”Ÿæˆã€éªŒè¯ä¸‰ä¸ªæ™ºèƒ½ä½“åˆ†å·¥
- çŠ¶æ€ç®¡ç†ï¼šè·Ÿè¸ªè¯æ˜çŠ¶æ€ã€é”™è¯¯å†å²ã€é‡è¯•æ¬¡æ•°
- ç­–ç•¥æ¨¡å¼ï¼šæ”¯æŒä¸åŒçš„è¯æ˜ç­–ç•¥ï¼ˆDFSã€BFSã€å¯å‘å¼æœç´¢ï¼‰

#### 2.2 ç›®å½•ç»“æ„
```
src/agent/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ base.py              # Agent åŸºç±»
â”œâ”€â”€ planning_agent.py    # è§„åˆ’æ™ºèƒ½ä½“ï¼šåˆ†æé—®é¢˜ï¼Œåˆ¶å®šç­–ç•¥
â”œâ”€â”€ generation_agent.py   # ç”Ÿæˆæ™ºèƒ½ä½“ï¼šç”Ÿæˆä»£ç å’Œè¯æ˜
â”œâ”€â”€ verification_agent.py # éªŒè¯æ™ºèƒ½ä½“ï¼šéªŒè¯ä»£ç æ­£ç¡®æ€§
â”œâ”€â”€ coordinator.py       # åè°ƒå™¨ï¼šç®¡ç†å¤šæ™ºèƒ½ä½“åä½œ
â”œâ”€â”€ state.py             # çŠ¶æ€ç®¡ç†
â””â”€â”€ strategies.py        # è¯æ˜ç­–ç•¥ï¼ˆDFSã€BFSç­‰ï¼‰
```

#### 2.3 æ ¸å¿ƒæ¥å£è®¾è®¡

```python
# src/agent/base.py
from abc import ABC, abstractmethod
from typing import Dict, Any, Optional
from dataclasses import dataclass

@dataclass
class AgentState:
    """æ™ºèƒ½ä½“çŠ¶æ€"""
    problem_description: str
    task_template: str
    current_code: str = ""
    current_proof: str = ""
    error_history: List[str] = None
    retry_count: int = 0
    max_retries: int = 5

class BaseAgent(ABC):
    """æ™ºèƒ½ä½“åŸºç±»"""
    
    def __init__(self, llm: BaseLLM, name: str):
        self.llm = llm
        self.name = name
    
    @abstractmethod
    def execute(self, state: AgentState) -> Dict[str, Any]:
        """æ‰§è¡Œæ™ºèƒ½ä½“ä»»åŠ¡"""
        pass
```

**è§„åˆ’æ™ºèƒ½ä½“** (`planning_agent.py`):
- åˆ†æé—®é¢˜æè¿°å’Œä»»åŠ¡æ¨¡æ¿
- åˆ¶å®šè¯æ˜ç­–ç•¥å’Œæ­¥éª¤
- è¯†åˆ«å…³é”®æ¦‚å¿µå’Œéœ€è¦çš„å®šç†

**ç”Ÿæˆæ™ºèƒ½ä½“** (`generation_agent.py`):
- æ ¹æ®è§„åˆ’ç”Ÿæˆ Lean4 ä»£ç 
- ç”Ÿæˆå¯¹åº”çš„å½¢å¼åŒ–è¯æ˜
- æ”¯æŒ RAG æ£€ç´¢ç›¸å…³ç¤ºä¾‹

**éªŒè¯æ™ºèƒ½ä½“** (`verification_agent.py`):
- æ‰§è¡Œ Lean4 ä»£ç éªŒè¯
- åˆ†æé”™è¯¯ä¿¡æ¯
- æä¾›ä¿®å¤å»ºè®®

**åè°ƒå™¨** (`coordinator.py`):
```python
class AgentCoordinator:
    """å¤šæ™ºèƒ½ä½“åè°ƒå™¨"""
    
    def __init__(self, planning_agent, generation_agent, verification_agent):
        self.planning_agent = planning_agent
        self.generation_agent = generation_agent
        self.verification_agent = verification_agent
    
    def solve(self, problem_description: str, task_template: str) -> Dict[str, str]:
        """åè°ƒå¤šæ™ºèƒ½ä½“è§£å†³é—®é¢˜"""
        state = AgentState(problem_description, task_template)
        
        # 1. è§„åˆ’é˜¶æ®µ
        plan = self.planning_agent.execute(state)
        
        # 2. ç”Ÿæˆé˜¶æ®µ
        solution = self.generation_agent.execute(state)
        state.current_code = solution["code"]
        state.current_proof = solution["proof"]
        
        # 3. éªŒè¯é˜¶æ®µï¼ˆè¿­ä»£ï¼‰
        while state.retry_count < state.max_retries:
            result = self.verification_agent.execute(state)
            if result["success"]:
                return {"code": state.current_code, "proof": state.current_proof}
            else:
                # æ ¹æ®é”™è¯¯ä¿¡æ¯é‡æ–°ç”Ÿæˆ
                state.error_history.append(result["error"])
                state.retry_count += 1
                solution = self.generation_agent.execute(state)
        
        raise Exception("Max retries exceeded")
```

---

### 3. å½¢å¼åŒ–éªŒè¯æ¨¡å— (`src/verifier/`)

#### 3.1 è®¾è®¡ç›®æ ‡
- Lean4 ä»£ç æ‰§è¡Œï¼šç¼–è¯‘å’ŒéªŒè¯ Lean4 ä»£ç 
- é”™è¯¯è§£æï¼šè§£æ Lean4 é”™è¯¯ä¿¡æ¯ï¼Œæå–æœ‰ç”¨ä¿¡æ¯
- çŠ¶æ€è·Ÿè¸ªï¼šè·Ÿè¸ªè¯æ˜çŠ¶æ€ï¼ˆgoalsã€hypothesesï¼‰

#### 3.2 ç›®å½•ç»“æ„
```
src/verifier/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ lean4_runner.py      # Lean4 ä»£ç æ‰§è¡Œå™¨
â”œâ”€â”€ error_parser.py      # é”™è¯¯ä¿¡æ¯è§£æå™¨
â”œâ”€â”€ state_tracker.py     # è¯æ˜çŠ¶æ€è·Ÿè¸ªå™¨
â””â”€â”€ repl_manager.py      # Lean4 REPL ç®¡ç†å™¨ï¼ˆå¯é€‰ï¼Œç”¨äºäº¤äº’å¼è¯æ˜ï¼‰
```

#### 3.3 æ ¸å¿ƒæ¥å£è®¾è®¡

```python
# src/verifier/lean4_runner.py
from typing import Dict, Optional
from dataclasses import dataclass

@dataclass
class Lean4Result:
    """Lean4 æ‰§è¡Œç»“æœ"""
    success: bool
    output: str
    error_message: Optional[str] = None
    goals: List[str] = None  # å½“å‰è¯æ˜ç›®æ ‡
    hypotheses: List[str] = None  # å½“å‰å‡è®¾

class Lean4Runner:
    """Lean4 ä»£ç æ‰§è¡Œå™¨"""
    
    def __init__(self, project_path: str, lean_version: str = "4.24.0"):
        self.project_path = project_path
        self.lean_version = lean_version
    
    def execute(self, code: str, timeout: int = 60) -> Lean4Result:
        """æ‰§è¡Œ Lean4 ä»£ç """
        # 1. å†™å…¥ä¸´æ—¶æ–‡ä»¶
        # 2. è¿è¡Œ lake lean
        # 3. è§£æè¾“å‡º
        pass
    
    def check_syntax(self, code: str) -> bool:
        """æ£€æŸ¥è¯­æ³•"""
        pass
```

**é”™è¯¯è§£æå™¨** (`error_parser.py`):
- è§£æ Lean4 ç¼–è¯‘é”™è¯¯
- æå–é”™è¯¯ç±»å‹ã€ä½ç½®ã€å»ºè®®
- æ ¼å¼åŒ–é”™è¯¯ä¿¡æ¯ä¾› Agent ä½¿ç”¨

**çŠ¶æ€è·Ÿè¸ªå™¨** (`state_tracker.py`):
- è·Ÿè¸ªè¯æ˜è¿‡ç¨‹ä¸­çš„ goals å’Œ hypotheses
- è®°å½•è¯æ˜æ­¥éª¤
- æ£€æµ‹å¾ªç¯å’Œæ­»é”

---

### 4. RL æ¨¡å— (`src/rl/`)

#### 4.1 è®¾è®¡ç›®æ ‡
- å¼ºåŒ–å­¦ä¹ è®­ç»ƒï¼šé€šè¿‡ RL ä¼˜åŒ–è¯æ˜ç­–ç•¥
- å¥–åŠ±è®¾è®¡ï¼šå®šä¹‰åˆé€‚çš„å¥–åŠ±å‡½æ•°
- ç­–ç•¥ç½‘ç»œï¼šè®­ç»ƒç­–ç•¥ç½‘ç»œé€‰æ‹©è¯æ˜æ­¥éª¤

#### 4.2 ç›®å½•ç»“æ„
```
src/rl/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ environment.py       # RL ç¯å¢ƒï¼šå°†è¯æ˜é—®é¢˜è½¬åŒ–ä¸º RL ç¯å¢ƒ
â”œâ”€â”€ reward.py           # å¥–åŠ±å‡½æ•°è®¾è®¡
â”œâ”€â”€ policy.py           # ç­–ç•¥ç½‘ç»œ
â”œâ”€â”€ trainer.py          # RL è®­ç»ƒå™¨
â”œâ”€â”€ q_tree.py           # Q-tree æ•°æ®ç»“æ„ï¼ˆå‚è€ƒ copraï¼‰
â””â”€â”€ utils.py            # RL å·¥å…·å‡½æ•°
```

#### 4.3 æ ¸å¿ƒæ¥å£è®¾è®¡

```python
# src/rl/environment.py
import gymnasium as gym
from typing import Tuple, Dict, Any

class Lean4ProofEnv(gym.Env):
    """Lean4 è¯æ˜ç¯å¢ƒ"""
    
    def __init__(self, problem: str, verifier: Lean4Runner):
        self.problem = problem
        self.verifier = verifier
        self.current_state = None
        self.step_count = 0
        self.max_steps = 100
    
    def reset(self) -> Tuple[Dict, Dict]:
        """é‡ç½®ç¯å¢ƒ"""
        # åˆå§‹åŒ–è¯æ˜çŠ¶æ€
        pass
    
    def step(self, action: str) -> Tuple[Dict, float, bool, bool, Dict]:
        """æ‰§è¡ŒåŠ¨ä½œï¼ˆè¯æ˜æ­¥éª¤ï¼‰"""
        # 1. åº”ç”¨è¯æ˜æ­¥éª¤
        # 2. éªŒè¯ç»“æœ
        # 3. è®¡ç®—å¥–åŠ±
        # 4. è¿”å›æ–°çŠ¶æ€
        pass
```

**å¥–åŠ±å‡½æ•°** (`reward.py`):
- æˆåŠŸå®Œæˆè¯æ˜ï¼š+100
- æ¯æ­¥è¿›å±•ï¼š+1
- é”™è¯¯æ­¥éª¤ï¼š-5
- è¶…æ—¶ï¼š-10

**ç­–ç•¥ç½‘ç»œ** (`policy.py`):
- è¾“å…¥ï¼šå½“å‰è¯æ˜çŠ¶æ€ï¼ˆgoals, hypothesesï¼‰
- è¾“å‡ºï¼šä¸‹ä¸€æ­¥è¯æ˜ç­–ç•¥çš„æ¦‚ç‡åˆ†å¸ƒ
- ä½¿ç”¨ Transformer æˆ– LSTM ç¼–ç çŠ¶æ€

---

### 5. æ•°æ®æ¨¡å— (`data/`)

#### 5.1 ç›®å½•ç»“æ„
```
data/
â”œâ”€â”€ benchmarks/          # åŸºå‡†æ•°æ®é›†
â”‚   â””â”€â”€ lean4/          # PutnamBench æ•°æ®é›†ï¼ˆå·²ä¸‹è½½ï¼‰
â”œâ”€â”€ prompts/            # æç¤ºè¯æ¨¡æ¿
â”‚   â”œâ”€â”€ system/         # ç³»ç»Ÿæç¤ºè¯
â”‚   â””â”€â”€ user/           # ç”¨æˆ·æç¤ºè¯æ¨¡æ¿
â”œâ”€â”€ cache/              # ç¼“å­˜ï¼ˆLLM å“åº”ã€åµŒå…¥ç­‰ï¼‰
â””â”€â”€ logs/               # æ—¥å¿—æ–‡ä»¶
```

#### 5.2 æç¤ºè¯è®¾è®¡

**ç³»ç»Ÿæç¤ºè¯** (`data/prompts/system/planning_agent.md`):
```
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ Lean4 å½¢å¼åŒ–è¯æ˜è§„åˆ’ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯ï¼š
1. åˆ†æé—®é¢˜æè¿°ï¼Œç†è§£éœ€è¦è¯æ˜çš„å†…å®¹
2. è¯†åˆ«å…³é”®æ¦‚å¿µå’Œéœ€è¦çš„å®šç†
3. åˆ¶å®šè¯æ˜ç­–ç•¥å’Œæ­¥éª¤
```

**ç”Ÿæˆæç¤ºè¯** (`data/prompts/system/generation_agent.md`):
```
ä½ æ˜¯ä¸€ä¸ª Lean4 ä»£ç ç”Ÿæˆä¸“å®¶ã€‚æ ¹æ®è§„åˆ’ç­–ç•¥ï¼Œç”Ÿæˆï¼š
1. å‡½æ•°å®ç°ä»£ç 
2. å½¢å¼åŒ–è¯æ˜æ­¥éª¤
```

---

### 6. é…ç½®æ¨¡å— (`config/`)

#### 6.1 é…ç½®æ–‡ä»¶ç»“æ„
```
config/
â”œâ”€â”€ default.yaml        # é»˜è®¤é…ç½®
â”œâ”€â”€ llm_config.yaml     # LLM é…ç½®
â”œâ”€â”€ agent_config.yaml   # Agent é…ç½®
â””â”€â”€ rl_config.yaml     # RL é…ç½®ï¼ˆæœªæ¥ï¼‰
```

#### 6.2 é…ç½®ç¤ºä¾‹

```yaml
# config/default.yaml
llm:
  provider: "openai"  # æˆ– "vllm", "ollama"
  model: "gpt-4o"
  temperature: 0.7
  max_tokens: 2048

agent:
  max_retries: 5
  timeout: 300
  use_rag: true

verifier:
  lean_version: "4.24.0"
  project_path: "./lean_playground"
  timeout: 60

rl:
  enabled: false  # æœªæ¥å¯ç”¨
  algorithm: "ppo"
  learning_rate: 0.0001
```

---

## ğŸ”„ æ•°æ®æµ

### å®Œæ•´å·¥ä½œæµç¨‹

```
1. è¾“å…¥é—®é¢˜
   â”œâ”€> description.txt (è‡ªç„¶è¯­è¨€æè¿°)
   â”œâ”€> signature.json (å‡½æ•°ç­¾å)
   â””â”€> task.lean (Lean4 æ¨¡æ¿)

2. è§„åˆ’æ™ºèƒ½ä½“
   â”œâ”€> åˆ†æé—®é¢˜
   â”œâ”€> åˆ¶å®šç­–ç•¥
   â””â”€> è¾“å‡ºè§„åˆ’

3. ç”Ÿæˆæ™ºèƒ½ä½“
   â”œâ”€> æ¥æ”¶è§„åˆ’
   â”œâ”€> RAG æ£€ç´¢ï¼ˆå¯é€‰ï¼‰
   â”œâ”€> ç”Ÿæˆä»£ç 
   â””â”€> ç”Ÿæˆè¯æ˜

4. éªŒè¯æ™ºèƒ½ä½“
   â”œâ”€> æ‰§è¡Œ Lean4 ä»£ç 
   â”œâ”€> æ£€æŸ¥é”™è¯¯
   â””â”€> è¿”å›ç»“æœ

5. è¿­ä»£ä¼˜åŒ–ï¼ˆå¦‚æœå¤±è´¥ï¼‰
   â”œâ”€> åˆ†æé”™è¯¯
   â”œâ”€> æ›´æ–°çŠ¶æ€
   â””â”€> é‡æ–°ç”Ÿæˆ

6. è¾“å‡ºç»“æœ
   â””â”€> {"code": "...", "proof": "..."}
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒä¾èµ–
- **Python**: 3.10+
- **Lean4**: 4.24.0+
- **LLM åº“**:
  - `openai`: OpenAI API
  - `vllm`: æœ¬åœ°æ¨¡å‹æ¨ç†
  - `ollama`: Ollama æœ¬åœ°æ¨¡å‹ï¼ˆå¯é€‰ï¼‰

### å·¥å…·åº“
- `pydantic`: æ•°æ®éªŒè¯
- `pyyaml`: é…ç½®æ–‡ä»¶è§£æ
- `dataclasses`: æ•°æ®ç±»
- `typing`: ç±»å‹æç¤º

### RL åº“ï¼ˆæœªæ¥ï¼‰
- `gymnasium`: RL ç¯å¢ƒ
- `torch`: æ·±åº¦å­¦ä¹ æ¡†æ¶
- `stable-baselines3`: RL ç®—æ³•åº“

---

## ğŸ“ å®ç°è®¡åˆ’

### é˜¶æ®µ 1: åŸºç¡€æ¡†æ¶ï¼ˆå½“å‰ï¼‰
- [x] é¡¹ç›®ç»“æ„æ­å»º
- [x] ä¸‹è½½ PutnamBench æ•°æ®é›†
- [ ] LLM æ¨¡å—åŸºç¡€å®ç°
  - [ ] BaseLLM æ¥å£
  - [ ] OpenAI å®¢æˆ·ç«¯
  - [ ] LLM å·¥å‚ç±»
- [ ] Agent æ¨¡å—åŸºç¡€å®ç°
  - [ ] BaseAgent æ¥å£
  - [ ] è§„åˆ’æ™ºèƒ½ä½“
  - [ ] ç”Ÿæˆæ™ºèƒ½ä½“
  - [ ] éªŒè¯æ™ºèƒ½ä½“
  - [ ] åè°ƒå™¨

### é˜¶æ®µ 2: æ ¸å¿ƒåŠŸèƒ½
- [ ] å½¢å¼åŒ–éªŒè¯æ¨¡å—
  - [ ] Lean4 æ‰§è¡Œå™¨
  - [ ] é”™è¯¯è§£æå™¨
  - [ ] çŠ¶æ€è·Ÿè¸ªå™¨
- [ ] RAG æ”¯æŒï¼ˆå¯é€‰ï¼‰
  - [ ] åµŒå…¥æ•°æ®åº“
  - [ ] ç›¸ä¼¼åº¦æœç´¢
- [ ] é…ç½®ç®¡ç†
- [ ] æ—¥å¿—ç³»ç»Ÿ

### é˜¶æ®µ 3: ä¼˜åŒ–ä¸æ‰©å±•
- [ ] å¤šæ™ºèƒ½ä½“åä½œä¼˜åŒ–
- [ ] é”™è¯¯æ¢å¤æœºåˆ¶
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ã€æ‰¹é‡å¤„ç†ï¼‰
- [ ] å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

### é˜¶æ®µ 4: RL æ¨¡å—ï¼ˆæœªæ¥ï¼‰
- [ ] RL ç¯å¢ƒå®ç°
- [ ] å¥–åŠ±å‡½æ•°è®¾è®¡
- [ ] ç­–ç•¥ç½‘ç»œå®ç°
- [ ] è®­ç»ƒæµç¨‹
- [ ] è¯„ä¼°å’Œå¯¹æ¯”

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# å®‰è£… Python ä¾èµ–
pip install -r requirements.txt

# å®‰è£… Lean4ï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
curl https://elan.lean-lang.org/elan-init.sh -sSf | sh
elan toolchain install 4.24.0
```

### 2. é…ç½® LLM
```bash
# è®¾ç½® OpenAI API Keyï¼ˆå¦‚æœä½¿ç”¨ OpenAIï¼‰
export OPENAI_API_KEY="sk-..."

# æˆ–é…ç½®æœ¬åœ° vLLMï¼ˆå¦‚æœä½¿ç”¨æœ¬åœ°æ¨¡å‹ï¼‰
# å‚è€ƒ vLLM æ–‡æ¡£
```

### 3. è¿è¡Œç¤ºä¾‹
```python
from src.llm.factory import LLMFactory
from src.llm.base import LLMConfig
from src.agent.coordinator import AgentCoordinator

# åˆ›å»º LLM
config = LLMConfig(model_name="gpt-4o", temperature=0.7)
llm = LLMFactory.create_llm(config)

# åˆ›å»ºæ™ºèƒ½ä½“
coordinator = AgentCoordinator.from_config(config)

# è§£å†³é—®é¢˜
result = coordinator.solve(
    problem_description="...",
    task_template="..."
)
```

---

## ğŸ“š å‚è€ƒé¡¹ç›®

1. **Lean4-LLM-Ai-Agent-Mooc**: å¤šæ™ºèƒ½ä½“æ¶æ„å‚è€ƒ
2. **Lean_copra**: RL æ¨¡å—å’Œ Q-tree æ•°æ®ç»“æ„å‚è€ƒ
3. **PutnamBench**: æ•°æ®é›†å’Œé—®é¢˜æ ¼å¼å‚è€ƒ

---

## ğŸ” æœªæ¥æ‰©å±•

1. **å¤šè¯­è¨€æ”¯æŒ**: æ‰©å±•åˆ° Coqã€Isabelle ç­‰
2. **åˆ†å¸ƒå¼è®­ç»ƒ**: æ”¯æŒå¤šæœº RL è®­ç»ƒ
3. **Web ç•Œé¢**: å¯è§†åŒ–è¯æ˜è¿‡ç¨‹
4. **æ¨¡å‹å¾®è°ƒ**: é’ˆå¯¹ Lean4 çš„æ¨¡å‹å¾®è°ƒ
5. **çŸ¥è¯†åº“**: æ„å»ºå½¢å¼åŒ–è¯æ˜çŸ¥è¯†åº“

---

## ğŸ“„ è®¸å¯è¯

[å¾…å®š]

---

## ğŸ‘¥ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·å‚è€ƒè´¡çŒ®æŒ‡å—ã€‚

---

**æœ€åæ›´æ–°**: 2025-01-XX
**ç‰ˆæœ¬**: 0.1.0

